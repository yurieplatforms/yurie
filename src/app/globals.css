@import 'tailwindcss';
@plugin '@tailwindcss/typography';
@source "../node_modules/streamdown/dist/index.js";
@custom-variant dark (&:is(.dark *));

/* Utility class for Zalando Sans font (logo) */
.font-zalando {
  font-family: 'Zalando Sans Expanded', sans-serif;
  font-weight: 600;
  font-style: italic;
}

/*
  The default border color has changed to `currentColor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentColor);
  }
}

@layer base {
  html {
    overflow-y: auto;
  }

  /* Home page: no scrolling at any viewport size */
  html:has([data-page="home"]) {
    overflow: hidden;
  }

  body:has([data-page="home"]) {
    overflow: hidden;
  }
}

@layer base {
  :root {
    /* New Design Tokens */
    --card: #faf9f5;
    --ring: #c96442;
    --input: #b4b2a7;
    --muted: #ede9de;
    --accent: #e9e6dc;
    --border: #dad9d4;
    --radius: 0.5rem;
    --chart-1: #b05730;
    --chart-2: #9c87f5;
    --chart-3: #ded8c4;
    --chart-4: #dbd3f0;
    --chart-5: #b4552d;
    --popover: #ffffff;
    --primary: #c96442;
    --sidebar: #f5f4ee;
    --secondary: #e9e6dc;
    --background: #faf9f5;
    --foreground: #3d3929;
    --destructive: #141413;
    --sidebar-ring: #b5b5b5;
    --sidebar-accent: #e9e6dc;
    --sidebar-border: #ebebeb;
    --card-foreground: #141413;
    --sidebar-primary: #c96442;
    --muted-foreground: #83827d;
    --accent-foreground: #28261b;
    --popover-foreground: #28261b;
    --primary-foreground: #ffffff;
    --sidebar-foreground: #3d3d3a;
    --secondary-foreground: #535146;
    --destructive-foreground: #ffffff;
    --sidebar-accent-foreground: #343434;
    --sidebar-primary-foreground: #fbfbfb;

    /* Semantic Aliases & Compatibility */
    --color-background: var(--background);
    --color-foreground: var(--foreground);
    --color-card: var(--card);
    --color-card-foreground: var(--card-foreground);
    --color-popover: var(--popover);
    --color-popover-foreground: var(--popover-foreground);
    --color-primary: var(--primary);
    --color-primary-foreground: var(--primary-foreground);
    --color-secondary: var(--secondary);
    --color-secondary-foreground: var(--secondary-foreground);
    --color-muted: var(--muted);
    --color-muted-foreground: var(--muted-foreground);
    --color-accent: var(--accent);
    --color-accent-foreground: var(--accent-foreground);
    --color-destructive: var(--destructive);
    --color-destructive-foreground: var(--destructive-foreground);
    --color-border: var(--border);
    --color-input: var(--input);
    --color-ring: var(--ring);
    --color-radius: var(--radius);

    /* Enhanced Semantic Tokens */
    --color-primary-hover: var(--chart-1); /* Darker shade of primary for hover */
    
    /* Legacy Mappings */
    --color-surface: var(--card);
    --color-surface-hover: var(--muted);
    --color-surface-active: var(--accent);
    --color-surface-elevated: var(--popover);
    --color-border-subtle: var(--muted);
    
    /* Input Specifics */
    --color-input-bg: var(--background);
    --color-input-border: var(--input);
    
    /* Shadows */
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.12);
    --shadow-accent: 0 4px 14px rgba(201, 100, 66, 0.25);
    --shadow-destructive: 0 4px 14px rgba(20, 20, 19, 0.2);

    /* Radius */
    --radius-sm: calc(var(--radius) - 2px);
    --radius-md: var(--radius);
    --radius-lg: var(--radius);
    --radius-xl: calc(var(--radius) + 4px);
    --radius-2xl: calc(var(--radius) + 8px);
    --radius-full: 9999px;
    --radius-input: 28px;
    --radius-card: var(--radius);
    --radius-dialog: calc(var(--radius) + 8px);
    --radius-prompt: 1.625rem;
    
    /* Spacing */
    --space-input-x: 1rem;
    --space-input-y: 0.625rem;
    --space-card: 1rem;
    --space-section: 1.5rem;
    
    /* Transitions */
    --transition-fast: 150ms ease;
    --transition-base: 200ms ease;
    --transition-slow: 300ms ease;

    /* Chart Colors exposed as vars */
    --color-chart-1: var(--chart-1);
    --color-chart-2: var(--chart-2);
    --color-chart-3: var(--chart-3);
    --color-chart-4: var(--chart-4);
    --color-chart-5: var(--chart-5);

    /* Sidebar Colors */
    --color-sidebar: var(--sidebar);
    --color-sidebar-foreground: var(--sidebar-foreground);
    --color-sidebar-primary: var(--sidebar-primary);
    --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
    --color-sidebar-accent: var(--sidebar-accent);
    --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
    --color-sidebar-border: var(--sidebar-border);
    --color-sidebar-ring: var(--sidebar-ring);

    /* Info/Success/Warning Colors */
    --color-info: var(--chart-2);
    --color-info-foreground: #ffffff;
    --color-success: #4c7c64;
    --color-success-foreground: #ffffff;
    --color-warning: #c7863e;
    --color-warning-foreground: #ffffff;
  }

  .dark {
    /* New Design Tokens (Dark) */
    --card: #262624;
    --ring: #d97757;
    --input: #52514a;
    --muted: #1b1b19;
    --accent: #1a1915;
    --border: #3e3e38;
    --chart-1: #b05730;
    --chart-2: #9c87f5;
    --chart-3: #1a1915;
    --chart-4: #2f2b48;
    --chart-5: #b4552d;
    --popover: #30302e;
    --primary: #d97757;
    --sidebar: #1f1e1d;
    --secondary: #faf9f5;
    --background: #262624;
    --foreground: #c3c0b6;
    --destructive: #ef4444;
    --sidebar-ring: #b5b5b5;
    --sidebar-accent: #0f0f0e;
    --sidebar-border: #ebebeb;
    --card-foreground: #faf9f5;
    --sidebar-primary: #343434;
    --muted-foreground: #b7b5a9;
    --accent-foreground: #f5f4ee;
    --popover-foreground: #e5e5e2;
    --primary-foreground: #ffffff;
    --sidebar-foreground: #c3c0b6;
    --secondary-foreground: #30302e;
    --destructive-foreground: #ffffff;
    --sidebar-accent-foreground: #c3c0b6;
    --sidebar-primary-foreground: #fbfbfb;

    /* Semantic Aliases & Compatibility (Dark) */
    --color-background: var(--background);
    --color-foreground: var(--foreground);
    --color-card: var(--card);
    --color-card-foreground: var(--card-foreground);
    --color-popover: var(--popover);
    --color-popover-foreground: var(--popover-foreground);
    --color-primary: var(--primary);
    --color-primary-foreground: var(--primary-foreground);
    --color-secondary: var(--secondary);
    --color-secondary-foreground: var(--secondary-foreground);
    --color-muted: var(--muted);
    --color-muted-foreground: var(--muted-foreground);
    --color-accent: var(--accent);
    --color-accent-foreground: var(--accent-foreground);
    --color-destructive: var(--destructive);
    --color-destructive-foreground: var(--destructive-foreground);
    --color-border: var(--border);
    --color-input: var(--input);
    --color-ring: var(--ring);

    /* Enhanced Semantic Tokens */
    --color-primary-hover: var(--chart-1); 

    /* Legacy Mappings */
    --color-surface: var(--card);
    --color-surface-hover: #404040;
    --color-surface-active: var(--accent);
    --color-surface-elevated: var(--popover);
    --color-border-subtle: var(--muted);

    /* Input Specifics */
    --color-input-bg: var(--background);
    --color-input-border: var(--input);

    /* Shadows */
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.4);
    --shadow-accent: 0 4px 14px rgba(217, 119, 87, 0.15);
    --shadow-destructive: 0 4px 14px rgba(239, 68, 68, 0.15);

    /* Info/Success/Warning Colors */
    --color-info: var(--chart-2);
    --color-info-foreground: #ffffff;
    --color-success: #34d399;
    --color-success-foreground: #ffffff;
    --color-warning: #fbbf24;
    --color-warning-foreground: #ffffff;
  }
}

:root {
  --sh-class: #61afef;
  --sh-sign: #56b6c2;
  --sh-string: #98c379;
  --sh-keyword: #c678dd;
  --sh-comment: #7f848e;
  --sh-jsxliterals: #61afef;
  --sh-property: #e5c07b;
  --sh-entity: #e06c75;
}

.dark {
  --sh-class: #79c0ff;
  --sh-sign: #a5d6ff;
  --sh-string: #a5d6a7;
  --sh-keyword: #ff7eb6;
  --sh-comment: #8b949e;
  --sh-jsxliterals: #79c0ff;
  --sh-property: #ffa657;
  --sh-entity: #ff7b72;
}

@theme inline {
  --color-card: var(--card);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-muted: var(--muted);
  --color-accent: var(--accent);
  --color-border: var(--border);
  --color-radius: var(--radius);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --color-popover: var(--popover);
  --color-primary: var(--primary);
  --color-sidebar: var(--sidebar);
  --color-secondary: var(--secondary);
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-destructive: var(--destructive);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-border: var(--sidebar-border);
  --color-card-foreground: var(--card-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent-foreground: var(--accent-foreground);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary-foreground: var(--primary-foreground);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  
  /* Additional Semantic Tokens */
  --color-primary-hover: var(--color-primary-hover);
  --color-surface: var(--color-surface);
  --color-surface-hover: var(--color-surface-hover);
  --color-surface-active: var(--color-surface-active);
  --color-surface-elevated: var(--color-surface-elevated);
  
  /* Success/Warning/Info */
  --color-success: var(--color-success);
  --color-warning: var(--color-warning);
  --color-info: var(--color-info);
  
  /* Radius & Shadows */
  --radius-sm: var(--radius-sm);
  --radius-md: var(--radius-md);
  --radius-lg: var(--radius-lg);
  --radius-xl: var(--radius-xl);
  --radius-2xl: var(--radius-2xl);
  --radius-full: var(--radius-full);
  --radius-input: var(--radius-input);
  --radius-card: var(--radius-card);
  
  --shadow-sm: var(--shadow-sm);
  --shadow-md: var(--shadow-md);
  --shadow-lg: var(--shadow-lg);
  --shadow-accent: var(--shadow-accent);
  --shadow-destructive: var(--shadow-destructive);
}

@layer utilities {
  /* Remove outer border from Streamdown-rendered tables (chat tables, markdown, etc.) */
  [data-streamdown="table"] {
    border-width: 0 !important;
  }

  /* Match table separator lines to PromptInput outline color */
  [data-streamdown="table"] thead,
  [data-streamdown="table"] tbody,
  [data-streamdown="table"] tr,
  [data-streamdown="table"] th,
  [data-streamdown="table"] td,
  .prose table,
  .prose thead,
  .prose tbody,
  .prose tr,
  .prose th,
  .prose td,
  .prose-gray table,
  .prose-gray thead,
  .prose-gray tbody,
  .prose-gray tr,
  .prose-gray th,
  .prose-gray td {
    border-color: var(--color-border);
  }

  .dark [data-streamdown="table"] thead,
  .dark [data-streamdown="table"] tbody,
  .dark [data-streamdown="table"] tr,
  .dark [data-streamdown="table"] th,
  .dark [data-streamdown="table"] td,
  .dark .prose table,
  .dark .prose thead,
  .dark .prose tbody,
  .dark .prose tr,
  .dark .prose th,
  .dark .prose td,
  .dark .prose-gray table,
  .dark .prose-gray thead,
  .dark .prose-gray tbody,
  .dark .prose-gray tr,
  .dark .prose-gray th,
  .dark .prose-gray td {
    border-color: var(--color-border);
  }

  /* Remove outer border from Streamdown-rendered code blocks */
  [data-streamdown="code-block"],
  [data-code-block-container="true"],
  [data-code-block-container] {
    border-width: 0 !important;
  }

  /* Match code block border + background colors to user chat bubble (muted) */
  [data-streamdown="code-block"],
  [data-code-block-container="true"],
  [data-code-block-container] {
    background-color: var(--muted) !important; 
  }

  .dark [data-streamdown="code-block"],
  .dark [data-code-block-container="true"],
  .dark [data-code-block-container] {
    background-color: var(--popover) !important;
  }

  /* Inner code area border + background */
  [data-streamdown="code-block-body"],
  [data-code-block] {
    border-top-width: 0 !important; /* remove separator line under header */
    border-color: var(--color-border);
    background-color: var(--muted) !important;
  }

  .dark [data-streamdown="code-block-body"],
  .dark [data-code-block] {
    border-color: var(--color-border);
    background-color: var(--popover) !important;
  }

  /* Remove extra space between header and code, and force unified background */
  [data-streamdown="code-block-body"] pre,
  [data-streamdown="code-block-body"] pre code,
  [data-streamdown="code-block"] pre,
  [data-streamdown="code-block"] pre code,
  [data-code-block] pre,
  [data-code-block] pre code {
    margin-top: 0;
    margin-bottom: 0;
    background-color: var(--muted) !important;
  }

  .dark [data-streamdown="code-block-body"] pre,
  .dark [data-streamdown="code-block-body"] pre code,
  .dark [data-streamdown="code-block"] pre,
  .dark [data-streamdown="code-block"] pre code,
  .dark [data-code-block] pre,
  .dark [data-code-block] pre code {
    background-color: var(--popover) !important;
  }

  /* Code block header surface + text (match code background) */
  [data-streamdown="code-block-header"],
  [data-code-block-header],
  [data-streamdown="code-block"] > div:first-child,
  [data-code-block-container] > div:first-child {
    background-color: var(--muted) !important;
    color: var(--color-foreground);
    border-bottom: 1px solid var(--color-border);
  }

  .dark [data-streamdown="code-block-header"],
  .dark [data-code-block-header],
  .dark [data-streamdown="code-block"] > div:first-child,
  .dark [data-code-block-container] > div:first-child {
    background-color: var(--popover) !important;
    color: var(--color-foreground);
    border-bottom: 1px solid var(--color-border);
  }

  /* Code block line numbers - match placeholder text color (muted-foreground) */
  [data-streamdown="code-block-body"] code > span::before,
  [data-streamdown="code-block"] code > span::before {
    color: var(--color-muted-foreground) !important;
    opacity: 1 !important;
  }

  /* Dark mode code block text - force high contrast readable colors */
  .dark [data-streamdown="code-block-body"] pre code,
  .dark [data-streamdown="code-block"] pre code,
  .dark [data-code-block] pre code,
  .dark pre code,
  .dark pre.shiki code {
    color: #e6edf3 !important;
  }

  /* Boost text brightness only, not background */
  .dark pre.shiki span,
  .dark pre.shiki code span,
  .dark [data-streamdown] pre span,
  .dark [data-streamdown] pre code span,
  .dark [data-streamdown="code-block"] pre span,
  .dark [data-streamdown="code-block-body"] pre span {
    filter: brightness(1.7) saturate(1.15) !important;
  }


  /* Specific token color overrides for dark mode - vibrant palette */
  .dark pre code .token.comment,
  .dark pre code .token.prolog,
  .dark pre code .token.doctype,
  .dark pre code .token.cdata {
    color: #8b949e !important;
    font-style: italic;
  }

  .dark pre code .token.punctuation {
    color: #c9d1d9 !important;
  }

  .dark pre code .token.property,
  .dark pre code .token.tag,
  .dark pre code .token.constant,
  .dark pre code .token.symbol,
  .dark pre code .token.deleted {
    color: #ff7b72 !important;
  }

  .dark pre code .token.boolean,
  .dark pre code .token.number {
    color: #79c0ff !important;
  }

  .dark pre code .token.selector,
  .dark pre code .token.attr-name,
  .dark pre code .token.string,
  .dark pre code .token.char,
  .dark pre code .token.builtin,
  .dark pre code .token.inserted {
    color: #a5d6a7 !important;
  }

  .dark pre code .token.operator,
  .dark pre code .token.entity,
  .dark pre code .token.url,
  .dark pre code .token.variable {
    color: #a5d6ff !important;
  }

  .dark pre code .token.atrule,
  .dark pre code .token.attr-value,
  .dark pre code .token.function,
  .dark pre code .token.class-name {
    color: #d2a8ff !important;
  }

  .dark pre code .token.keyword {
    color: #ff7eb6 !important;
  }

  .dark pre code .token.regex,
  .dark pre code .token.important {
    color: #ffa657 !important;
  }

  /* Match AI-generated horizontal rule separators to PromptInput outline color */
  [data-streamdown="horizontal-rule"],
  .prose hr,
  .prose-gray hr {
    border-color: var(--color-border);
  }

  .dark [data-streamdown="horizontal-rule"],
  .dark .prose hr,
  .dark .prose-gray hr {
    border-color: var(--color-border);
  }

  /* Match blockquote left border to user chat bubble color */
  .prose blockquote,
  .prose-gray blockquote,
  [data-streamdown] blockquote {
    border-left-color: var(--color-primary);
    background: linear-gradient(to right, color-mix(in srgb, var(--color-primary) 5%, transparent), transparent);
    padding: 0.75rem 1rem;
    margin-left: 0;
    margin-right: 0;
    border-radius: 0 0.5rem 0.5rem 0;
    font-style: italic;
  }

  .prose blockquote p,
  .prose-gray blockquote p,
  [data-streamdown] blockquote p {
    margin: 0;
  }

  .dark .prose blockquote,
  .dark .prose-gray blockquote,
  .dark [data-streamdown] blockquote {
    border-left-color: var(--color-primary);
    background: linear-gradient(to right, color-mix(in srgb, var(--color-primary) 8%, transparent), transparent);
  }

  /* Match inline code background to border/separator color */
  .prose code:not(pre code),
  .prose-gray code:not(pre code),
  [data-streamdown] code:not(pre code) {
    background-color: var(--color-border);
  }

  .dark .prose code:not(pre code),
  .dark .prose-gray code:not(pre code),
  .dark [data-streamdown] code:not(pre code) {
    background-color: var(--color-border);
  }
  
  /* Bullet points - force them to use the muted-foreground color */
  .prose ul > li::marker,
  .prose-gray ul > li::marker,
  .prose ol > li::marker,
  .prose-gray ol > li::marker {
    color: var(--color-muted-foreground) !important;
  }

  .dark .prose ul > li::marker,
  .dark .prose-gray ul > li::marker,
  .dark .prose ol > li::marker,
  .dark .prose-gray ol > li::marker {
    color: var(--color-muted-foreground) !important;
  }

  /* Enhanced list typography */
  .prose ul,
  .prose-gray ul,
  .prose ol,
  .prose-gray ol {
    padding-left: 1.5rem;
  }

  .prose li,
  .prose-gray li {
    padding-left: 0.25rem;
  }

  /* Nested list styling */
  .prose ul ul,
  .prose-gray ul ul,
  .prose ol ol,
  .prose-gray ol ol,
  .prose ul ol,
  .prose-gray ul ol,
  .prose ol ul,
  .prose-gray ol ul {
    margin-top: 0.5rem;
    margin-bottom: 0.25rem;
  }

  /* Horizontal rules as section dividers */
  .prose hr,
  .prose-gray hr {
    margin-top: 2rem;
    margin-bottom: 2rem;
    border-top-width: 1px;
    opacity: 0.5;
  }

  /* Paragraph with better rhythm */
  .prose p + p,
  .prose-gray p + p {
    margin-top: 1rem;
  }

  /* Better heading separation from content */
  .prose h1 + *,
  .prose h2 + *,
  .prose h3 + *,
  .prose-gray h1 + *,
  .prose-gray h2 + *,
  .prose-gray h3 + * {
    margin-top: 0 !important;
  }

  /* Numbered list prefix styling */
  .prose ol > li {
    counter-increment: list-counter;
  }

  .prose ol > li::marker {
    font-weight: 500;
  }

  /* AI-generated links in prose content - use primary color */
  .prose a,
  .prose-gray a,
  [data-streamdown] a {
    color: var(--color-primary);
    text-decoration: underline;
    text-underline-offset: 2px;
    transition: color 0.15s ease;
  }

  .prose a:hover,
  .prose-gray a:hover,
  [data-streamdown] a:hover {
    color: var(--color-primary-hover);
  }

  .dark .prose a,
  .dark .prose-gray a,
  .dark [data-streamdown] a {
    color: var(--color-primary);
  }

  .dark .prose a:hover,
  .dark .prose-gray a:hover,
  .dark [data-streamdown] a:hover {
    color: var(--color-primary-hover);
  }

  /* KaTeX LaTeX math styling */
  .prose .katex {
    font-size: 1.3em !important;
  }

  .prose .katex-display {
    margin: 1.5rem 0;
    overflow-x: auto;
    overflow-y: hidden;
    padding: 0.75rem 0;
  }

  .prose .katex-display > .katex {
    text-align: center;
    font-size: 1.6em !important;
  }

  /* Math display blocks styling */
  .prose .math-display,
  [data-streamdown] .math-display {
    margin: 1.5rem 0;
    padding: 1rem;
    border-radius: 0.5rem;
    background-color: var(--color-surface);
    overflow-x: auto;
  }

  .dark .prose .math-display,
  .dark [data-streamdown] .math-display {
    background-color: var(--popover);
  }

  /* Inline math styling - subtle background for readability */
  .prose .math-inline,
  [data-streamdown] .math-inline {
    padding: 0.1em 0.2em;
    border-radius: 0.25rem;
  }

  /* PromptKit-style text loaders (text-blink, loading-dots) */
  .loader-text-blink {
    animation: loader-text-blink 1.1s ease-in-out infinite;
  }

  @keyframes loader-text-blink {
    0%,
    100% {
      opacity: 0.3;
    }
    50% {
      opacity: 1;
    }
  }

  .loader-loading-dots::after {
    content: '...';
    display: inline-block;
    width: 1.5em;
    text-align: left;
    animation: loader-loading-dots 1.4s steps(4, end) infinite;
  }

  @keyframes loader-loading-dots {
    0% {
      content: '';
    }
    25% {
      content: '.';
    }
    50% {
      content: '..';
    }
    75%,
    100% {
      content: '...';
    }
  }
}
